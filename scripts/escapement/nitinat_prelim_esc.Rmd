---
title: "Nitinat escapement 2023 (PRELIM)"
author: "South Coast StA"
date: "Last update: `r Sys.Date()`"
output: 
  bookdown::html_document2:
    toc: true
    toc_float: true
    toc_collapsed: false 
    toc_depth: 5
    number_sections: true
knit: (function(inputFile, encoding) { 
  rmarkdown::render(inputFile, encoding=encoding, output_file=paste0(substr(inputFile,1,nchar(inputFile)-4), "_PRELIMINARY_", format(Sys.Date(), 
  sep="_", "%Y-%m-%d"), '.html'))
  }
  )
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=F, warning=F, message=F)

# Function for appending date to html output - copy into YAML below output:
#

# Load libraries ----------------------------
library(tidyverse)
library(readxl)
library(here)
library(ggpubr)
library(kableExtra)


# Helpers ----------------------------
options(scipen = 9999999)
"%notin%" <- Negate("%in%")
analysis_year <- 2023


# ============================= Load data ============================
# OneDrive directory:
OD.dir <- paste("C:/Users", Sys.info()[6], "OneDrive - DFO-MPO/# Escapement Estimates/# 2023/Area 21-22/", sep="/")


# Raw SIL DATA ----------------------------

# Raw SIL entry for Nitinat lower/mid/upper designations compared to water level etc: 
nit.sil <- list.files(paste0("//dcbcpbsna01a.ENT.dfo-mpo.ca/SCD_Stad/WCVI/ESCAPEMENT/Data/",
                             analysis_year,
                             "/SILs/Area 21-22/Nitinat River/"),
                      pattern = "^A22_Nitinat_River*.*xlsx", full.names = T) %>% 
  map(~readxl::read_excel(path=.x, trim_ws=T, guess_max=20000, sheet="Nitinat River raw SIL entry"), id="path") %>% 
  list_rbind() %>% 
  print()
  

# Raw SIL entry for Tribs compared to water level etc: 
tribs.sil <- list.files(paste0("//dcbcpbsna01a.ENT.dfo-mpo.ca/SCD_Stad/WCVI/ESCAPEMENT/Data/",
                             analysis_year,
                             "/SILs/Area 21-22/Tribs/"),
                      pattern = "^A22_Tributaries*.*xlsx", full.names = T) %>% 
  map(~readxl::read_excel(path=.x, trim_ws=T, guess_max=20000, sheet="Tributaries Raw SIL entry"), id="path") %>% 
  list_rbind() %>% 
  print()




# SIL+AUC DATABASE DATA ----------------------------

# SIL+AUC DB TABLE: Waterbody values (to join to EscEStSppHeader table):
wbdyVals <- readxl::read_excel(path=here("data", "escapement", "prelim-inseason", "WaterbodiesValues.xlsx")) %>% 
  mutate(AREA = case_when(NAME=="TUCK LAKE" ~ "22",
                          TRUE ~ AREA)) %>%
  select(AREA, NAME, WATERSHED_CDE) %>% 
  rename(WatershedCode = WATERSHED_CDE) %>% 
  filter(!is.na(WatershedCode)) %>% 
  group_by(AREA, NAME, WatershedCode) %>% 
  filter(AREA %in% c(20,21,22)) %>% 
  group_by(WatershedCode) %>% 
  mutate(n=n(),
         system = case_when(n>1 ~ paste0("system", seq(1,length(n),by=1)),
                            n==1 ~ "system1")) %>% 
  group_by(WatershedCode) %>% 
  pivot_wider(names_from=system, values_from=NAME) %>% 
  #select(-n) %>% 
  unite("SystemName", system1:system3, sep=", ", remove=T, na.rm=T) %>% 
  mutate(SystemName = str_to_title(SystemName)) %>%
  print()



# SIL+AUC DB TABLE: AUC Data Table for analysis: 
AUCdataTable <- readxl::read_excel(path=here("data", "escapement", "prelim-inseason", "AUC_DataAnalysisTable_area21-22.xlsx"))



# SIL+AUC DB TABLE: EscEstSppHeader table:
escEstSpp <- readxl::read_excel(path=here("data", "escapement", "prelim-inseason", "EscEstSppHeader_area20-22.xlsx")) %>% 
  left_join(.,
            wbdyVals,
            na_matches="never", relationship="many-to-one") %>%
  mutate(AdultMidResidenceTime_R = round((AdultShortResidenceTime + AdultLongResidenceTime)/2,1),
         JackMidResidenceTime_R = round((JackShortResidenceTime + JackLongResidenceTime)/2,1),
         AdultExpAUCMidValue_R = round(AdultExpAUCSumOfFishDays/AdultMidResidenceTime_R,0),
         JackExpAUCMidValue_R = round(JackExpAUCSumOfFishDays/JackMidResidenceTime_R,0)) %>% 
  relocate(AdultMidResidenceTime_R, .before = AdultLongResidenceTime) %>%
  relocate(JackMidResidenceTime_R, .before = JackLongResidenceTime) %>% 
  relocate(AdultExpAUCMidValue_R, .before=AdultExpAUCHighValue) %>% 
  relocate(JackExpAUCMidValue_R, .before=JackExpAUCHighValue) 


# SIL+AUC DB TABLE: EscEstAUCResults table: 
escEstAUC <- readxl::read_excel(path=here("data", "escapement", "prelim-inseason", "EscEstAUCResults_area20-22.xlsx")) %>% 
  left_join(.,
            wbdyVals,
            na_matches="never", relationship="many-to-one") %>% 
  mutate(method = case_when(DateRange== "2023/10/12 - 2023/10/26" ~ "heli",
                            TRUE ~ "snorkel"))



# SIL+AUC database ----------------------------
#ver23 <- readxl::read_excel(path=paste0(OD.dir, "Area22_SIL+AUC_database_output_2024-01-05 - AUC.xlsx"), sheet="raw")
#AUC23 <- readxl::read_excel(path=paste0(OD.dir, "Area22_SIL+AUC_database_output_2024-01-05 - AUC.xlsx"), sheet="AUC")



# Hatchery ----------------------------
nrh.cn <- readxl::read_excel("//dcbcpbsna01a.ENT.dfo-mpo.ca/SCD_Stad/WCVI/ESCAPEMENT/Data/2023/SILs/Area 21-22/Adult_Management - Nitinat CN 2023.xlsx", sheet="Adult Management", guess_max=20000, skip=1) %>% 
  rename(InventoryLot=`Inventory Lot`, 
         ParentActivityType=`Parent Activity Type`, 
         SourceLocationType=`Source Location Type`,
         TotalCount=`Total Count`,
         MaturityClass=`Maturity Class`)

nrh.cm <- readxl::read_excel("//dcbcpbsna01a.ENT.dfo-mpo.ca/SCD_Stad/WCVI/ESCAPEMENT/Data/2023/SILs/Area 21-22/Nitinat Chum Removals_By Date_Nov 29_2023.xlsx", sheet="All Adult Activities", skip=1) 

nrh.co <- readxl::read_excel("//dcbcpbsna01a.ENT.dfo-mpo.ca/SCD_Stad/WCVI/ESCAPEMENT/Data/2023/SILs/Area 21-22/Adult_Management - Nitinat COHO 2023.xlsx", sheet="Adult Management", guess_max=20000, skip=1) %>% 
  rename(InventoryLot=`Inventory Lot`, 
         ParentActivityType=`Parent Activity Type`, 
         SourceLocationType=`Source Location Type`,
         TotalCount=`Total Count`,
         MaturityClass=`Maturity Class`)


# Enviro ----------------------------
nit.water <- list.files(here::here("data", "enviro"), pattern = "NitinatWaterLevelHydrometData", full.names = T) %>% 
  map(~readxl::read_excel(path=.x, sheet="Exported Data", guess_max=20000)) %>%
  purrr::list_rbind() %>%
  mutate(gauge_m = case_when(grepl("Estimated", `Staff Gauge(mH20)`) ~ NA,
                             TRUE ~ as.numeric(`Staff Gauge(mH20)`)),
         sensor_depth = case_when(grepl("Estimated", `Sensor Depth(mH20)`) ~ NA,
                             TRUE ~ as.numeric(`Sensor Depth(mH20)`)),
         date = as.Date(Time)) %>% 
  filter(#date<= as.Date("2023-11-08"), 
         gauge_m>0.000)



# Run timing ----------------------------
nit.rtStWk <- readxl::read_excel("//dcbcpbsna01a.ENT.dfo-mpo.ca/SCD_Stad/WCVI/ESCAPEMENT/Data/run timing tables (updated).xlsx", 
                                    sheet="Nitinat", guess_max=10000, trim_ws=T, range=cell_limits(c(4, 1), c(NA, NA))) %>% 
  select(-c(`...24`:`...75`)) %>%
  rename(year=`...1`) %>% 
  filter(if_any(everything(), ~ !is.na(.)), !grepl("Table", year), !grepl("Year", year), !is.na(year)) %>% 
  mutate(species = c(rep("chinook", nrow(.)/3), rep("coho", nrow(.)/3), rep("chum", nrow(.)/3)),
         `92` = case_when(`92`=="1000-2000" ~ as.numeric(1500),
                          TRUE ~ as.numeric(`92`)),
         across(c(`81`:`124`), ~as.numeric(.)),
         plot_group = case_when(year==analysis_year ~ year,
                                year!=analysis_year ~ paste0(min(year), sep="-", (analysis_year-1)))) %>%
  pivot_longer(cols = c(`81`:`124`), names_to = "stat_week", values_to = "count") %>% 
  print()

nit.rtStWk$stat_week <- factor(nit.rtStWk$stat_week,
                               levels=c("81","82","83","84",
                                        "91","92","93","94",
                                        "101","102","103","104","105",
                                        "111","112","113","114","115",
                                        "121","122","123","124", ordered=T))

# Escapement ----------------------------
nit.esc <- readxl::read_excel(path=here("data", "escapement", "NuSEDS_Area21-22_escapement_Jan2024.xlsx"), sheet="Data")

nit.esc.goal <- read.csv(here("data", "escapement", "wcviCK-BootstrappedRPs.csv")) %>% 
  filter(Stock=="Nitinat")
```

<br>

<br>









# **Sockeye**            
 
<br>

Snorkel and heli surveys were primarily timed for Chinook and Chum. Sockeye counts are incidental and should be considered low-quality/incomplete. Very low water this summer likely resulted in a barrier to migration, preventing sockeye from reaching Parker Creek until rains came much later. For this reason, SK counts in 2023 may be much higher than previous years as they were trapped in the lower mainstem and more visible to surveyors in late August.

<br>

## Area 21-22 raw vs expanded counts

Counts are expanded for both % population surveyed and/or observer efficiency, depending on survey conditions.  

```{r}
# ggplot() +
#   geom_bar(data=ver23 %>% filter(ShortSpecies=="SK") %>% pivot_longer(LiveAdults:ExpDeadJacks, names_to="est_type", values_to="n") %>% filter(est_type %in% c("LiveAdults", "ExpLiveAdults")), 
#            aes(x=as.Date(Date), y=n, colour=est_type, fill=est_type), stat="identity", position="dodge", alpha=0.5) +
#   labs(x="", y="Adult Sockeye counts", fill="Expansion", colour="Expansion") +
#   scale_x_date(date_breaks="7 day", date_labels = "%b %d") +
#   theme_bw() +
#   theme(axis.text.x = element_text(angle=45, hjust=1))

ggplot() +
  geom_bar(data=AUCdataTable %>% 
             filter(ShortSpecies=="SK") %>% 
             pivot_longer(c(LiveAdults:TotalJacks,ExpLiveAdults:ExpDeadJacks), names_to="est_type", values_to="n") %>% 
             filter(est_type %in% c("LiveAdults", "ExpLiveAdults")), 
           aes(x=as.Date(SDate), y=n, colour=est_type, fill=est_type), stat="identity", position="dodge", alpha=0.5) +
  labs(x="", y="Adult Sockeye counts", fill="Expansion", colour="Expansion") +
  scale_x_date(date_breaks="7 day", date_labels = "%b %d") +
  #scale_y_continuous(limits=c(0, max(AUCdataTable[AUCdataTable$ShortSpecies=="SK",]$ExpLiveAdults,na.rm=T))) +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1),
        legend.position = "bottom") +
  facet_wrap(~Section_AreaInspected, scales="free_y")
```

Figure: Live Adult sockeye raw counts (blue) and counts expanded for % population and/or OE (pink). 

<br>

<br>

## Counts & environmentals

Period of time log jam was impassable to sockeye in 2023. 

```{r include=F}
nit.water %>% 
  group_by(date) %>% 
  summarize(mean = mean(gauge_m)) %>% 
  mutate(mean = round(mean, 1)) %>% group_by(threshold=mean<=1.1) %>% group_by(threshold) %>% 
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") #%>%
  #collapse_rows(columns=c(1:4), valign="middle", target=1) 
```


```{r}
ggplot() +
  geom_rect(aes(xmin=as.Date("2023-07-15"), xmax=as.Date("2023-07-24"), ymin=-Inf, ymax=Inf), color="transparent", fill="orange", alpha=0.3) +
  geom_rect(aes(xmin=as.Date("2023-07-31"), xmax=as.Date("2023-09-24"), ymin=-Inf, ymax=Inf), color="transparent", fill="orange", alpha=0.3) +
  geom_ribbon(data=nit.water %>% group_by(date) %>% summarize(min=min(gauge_m), max=max(gauge_m)), 
              aes(x=as.Date(date), ymin=min*100, ymax=max*100), fill="dodger blue", alpha=0.5) +
  geom_line(data=nit.water %>% group_by(date) %>% summarize(mean = mean(gauge_m)), 
            aes(x=as.Date(date), y=mean*100), colour="dodger blue") +
  
  geom_bar(data=nit.sil %>% filter(species=="Sockeye") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
             summarize(n=sum(`adults live / habitat seen (# Est Live)`)), 
           aes(x=as.Date(date), y=n, group=type, fill=`upper/lower (for Nitinat River only)`, colour=`upper/lower (for Nitinat River only)`), 
           stat="identity", position="stack", alpha=0.7) +

  scale_y_continuous(sec.axis = sec_axis(~./100, name="Staff gauge (m)")) +
  scale_x_date(date_breaks="7 day", date_labels="%b %d") +
  labs(x="", y="Expanded adult Sockeye", fill="Segment", colour="Segment") +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```

*Figure: Sockeye counts (expanded adults), water levels (blue line), and period of time water level was <1.1m (believed to be about where the log jam becomes impassable in 2023).*

Only about 2-3% of the total SK counts were above the log jam.

<br>

<br>

## Behaviour & carcasses

```{r}
  ggplot() +
    geom_bar(data=nit.sil %>% filter(species=="Sockeye") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
               summarize(Spawning=sum(`adults # spawning`),
                         Holding = sum(`adults # holding`)) %>% pivot_longer(cols=c(Spawning,Holding), names_to="behaviour", values_to="count"), 
             aes(x=as.Date(date), y=count, fill=behaviour, colour=`upper/lower (for Nitinat River only)`), 
             stat="identity", position="stack", alpha=0.7, size=1) +
    geom_point(data=nit.sil %>% filter(species=="Sockeye") %>% group_by(date) %>% 
                 summarize(n=sum(`adults dead`)), 
               aes(x=as.Date(date), y=n), size=2, alpha=0.5) +
    geom_line(data=nit.sil %>% filter(species=="Sockeye") %>% group_by(date) %>% 
                summarize(n=sum(`adults dead`)), 
              aes(x=as.Date(date), y=n), 
              stat="identity", position="stack") +
    #scale_y_continuous(sec.axis = sec_axis(~./2, name="Carcasses")) +
    scale_x_date(date_breaks="7 day", date_labels = "%b %d")+
    scale_fill_manual(breaks=waiver(), values=c("transparent", "gray")) +
    labs(x="", y="Spawning adult Sockeye", fill="Behaviour", colour="Segment") +
    theme_bw() +
    theme(axis.text.x = element_text(angle=45, hjust=1))
```
<br>

Figure: Top: Expanded live Sockeye (bars) and carcasses (black line) in the Nitinat mainstem. Bottom: Spawning (gray bars) and holding (white bars) adult Sockeye and carcasses (black line). 

<br>

<br>

## Snorkel & swim-in counts

There are no swim-ins for Nitinat sockeye as they are not enhanced. 

<br>

<br>

## Tributaries (River and Lake)

Sockeye were present in Hobiton and Campus Creeks in 2023, but the primary enumeration method is by NTC and DFN echosounder. 
Hobiton was swum once late May due to delays in the echosounder installation, and again in late August during drought conditions to assess whether pre-spawn mortalities were occurring in the creek. Only one pre-spawn jack was noted, the remaining dead were too deep or too decomposed to assess mortality. 

```{r}
tribs.sil %>% 
  filter(species=="Sockeye") %>% 
  group_by(date, system) %>% 
  summarize(exp_ad_live = sum(`adults live / habitat seen (# Est Live)`),
            dead_adults = sum(`adults dead`),
            jk_live = sum(`jacks live`),
            jk_dead = sum(`jacks dead`)) %>%
  mutate(across(c(exp_ad_live:dead_adults), ~round(., 0))) %>%
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1), valign="middle", target=1) 
```

<br>

```{r}
ggplot() +
  geom_bar(data=nit.sil %>% 
             filter(species=="Sockeye") %>% 
             group_by(surveyNum, date, system) %>% 
             summarize(Spawning=sum(`adults # spawning`),
                       Holding = sum(`adults # holding`)) %>% 
             pivot_longer(cols=c(Spawning,Holding), names_to="behaviour", values_to="count"), 
           aes(x=as.Date(date), y=count, fill=behaviour, colour=system), 
           stat="identity", position="stack", alpha=0.7, size=1, width=1) +
  geom_bar(data = tribs.sil %>% 
             filter(species=="Sockeye", trib_status=="Nitinat trib") %>% 
             group_by(system, date) %>% 
             summarize(Spawning=sum(`adults # spawning`),
                       Holding = sum(`adults # holding`)) %>% 
             pivot_longer(cols=c(Spawning,Holding), names_to="behaviour", values_to="count"),
           aes(x=as.Date(date), y=count*1, colour=system, fill=behaviour), stat="identity",  alpha=0.8, size=1, width=1) +
  scale_y_continuous(sec.axis = sec_axis(~./1, name="Trib count")) +
  scale_fill_manual(breaks=waiver(), values=c("transparent", "gray")) +
  labs(x="", y="mainstem count") +
  theme_bw()
```

Figure: Mainstem Nitinat (pink) and trib (blue) counts for Sockeye adults (raw).  

<br>

<br>

## AUC assessments

<br>

The information below is meant to assist with determining if AUC is an appropriate method, and whether to include/exclude certain surveys. 

<br>

Table: AUC math for systems receiving AUC estimate in `r analysis_year`

```{r}
escEstAUC %>%
  filter(AREA!="20", ShortSpecies=="SK", grepl("Nitinat", SystemName)) 
```

<br>

```{r}
ggplot() +
  geom_line(data=escEstAUC%>%filter(ShortSpecies=="SK", AREA!="20", grepl("Nitinat", SystemName)), 
            aes(x=as.Date(DateRange), y=ExpAdultFishDays)) +
  geom_point(data=escEstAUC%>%filter(ShortSpecies=="SK", AREA!="20", grepl("Nitinat", SystemName)), 
             aes(x=as.Date(DateRange), y=ExpAdultFishDays, fill=method, colour=method), shape=21, size=4) +
  scale_fill_manual(breaks=c("heli", "snorkel"), values=c("orange", "blue")) +
  scale_colour_manual(breaks=c("heli", "snorkel"), values=c("orange", "blue")) +
  labs(x="", y="Fish-days", fill="Survey method", colour="Survey method") +
  theme_bw()
```

Figure: AUC curvey for Nitinat mainstem Sockeye. Note in 2023 this had already excluded the heli survey, but in future would likely also include the flight for reference. 

<br>

<br>

## Area 21-22 preliminary escapement estimates  

<br>

Table: Raw swim data (raw and expanded live and dead) for Sockeye.  

```{r}
AUCdataTable %>% 
  filter(ShortSpecies=="SK") %>% 
  select(ShortSpecies,Section_AreaInspected, SDate, WaterTemperature, WaterClarity, LiveAdults, DeadAdults,LiveJacks,DeadJacks, ExpLiveAdults,
         ExpDeadAdults, ExpLiveJacks, ExpDeadJacks, OverallReliability, EstPctSeen) %>% 
  mutate(across(c(LiveAdults:ExpDeadJacks), ~round(., 0))) %>% 
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1:4), valign="middle", target=1) 
```

<br>

Table: Escapement estimates for each system. 

```{r}
escEstSpp %>% 
  filter(ShortSpecies=="SK", AREA!="20") %>% 
  select(-c(WatershedCode, contains("Recommend"), EstimateConfidence, OptimumEscapement, n, contains("Raw"), contains("FishDays"))) %>% 
  relocate(c(SystemName, AREA), .before=ShortSpecies) %>% 
  rename(FinalAdultEstimate = AdultNaturalReco,
         FinalJackEstimate = JackNaturalReco) %>% 
  mutate(across(FinalJackEstimate:FinalAdultEstimate, ~case_when(.<0 ~ 0,
                                                                 TRUE ~ .))) %>%
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1:4), valign="middle", target=1) 
```

<br>

<br>

### Estimate decision:

For 2023 used an AUC estimate with SL=35 days. Low water was a migration barrier and likely meant sockeye were much more visible to surveyors later in the season than usual (they were prevented from migrating further upstream to Parker Creek); therefore 2023 estimate may be much higher relative to previous years. Expanded escapement estimate with 35 day survey life is 509 adults + 10 jacks (519 total). Type-4 estimate due to frequent surveys, but slightly wrong time of year. Heli survey excluded. See Chinook section for commentary about expansions for omission of Reach 5-4 on Oct 5 survey due to bear activity.  *This is subject to change; see EscBatchHardCopy report for specific estimate abundance.*

<br>

<br>

## `r analysis_year` compared to historical run timing and abundance

Run timing information is not available for Nitinat Sockeye.

<br>

```{r}
ggplot()  +
  geom_bar(data=nit.esc %>% filter(`Waterbody Name`=="NITINAT RIVER", `Species Qualified`=="SEL"), 
           aes(x=`Analysis Year`, y=`Natural Adult Spawners`), stat="identity", colour="dodger blue", fill="dodger blue", alpha=0.8) +
  geom_bar(data=nit.esc %>% filter(`Waterbody Name`=="NITINAT RIVER", `Species Qualified`=="SEL"), 
           aes(x=`Analysis Year`, y=`Unspecified Return`), stat="identity", colour="gray80", fill="gray80", alpha=0.8) +  
  geom_bar(data=escEstSpp %>% 
             filter(ShortSpecies=="SK", AREA!="20", grepl("Nitinat", SystemName)) %>% 
             select(Year, SystemName, AdultNaturalReco) %>% 
             summarize(n=sum(AdultNaturalReco)), 
             aes(x=analysis_year, y=n), stat="identity", colour="red", fill="dodger blue", alpha=0.4) +   
  scale_x_continuous(breaks=seq(min(nit.esc$`Analysis Year`), analysis_year, by=2)) +
  labs(x="Return Year", y="Sockeye spawners") +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```

Figure: `r analysis_year` preliminary adult Sockeye escapement estimate (red outline) relative to historical adult (blue) and unspecified (gray) escapement estimates. Gaps indicate years without estimates. 

<br>

<br>


























# **Coho**            
 
<br>

Six snorkel surveys were conducted in 2023, but only the latter ones can be considered representative for Coho (they were only seen on 4 of the 6 surveys).  

<br>

## Area 21-22 raw vs expanded counts

Counts are expanded for both % population surveyed and/or observer efficiency, depending on survey conditions.  

```{r}
ggplot() +
  geom_bar(data=AUCdataTable %>% 
             filter(ShortSpecies=="CO") %>% 
             pivot_longer(c(LiveAdults:TotalJacks,ExpLiveAdults:ExpDeadJacks), names_to="est_type", values_to="n") %>% 
             filter(est_type %in% c("LiveAdults", "ExpLiveAdults")), 
           aes(x=as.Date(SDate), y=n, colour=est_type, fill=est_type), stat="identity", position="dodge", alpha=0.5) +
  labs(x="", y="Adult Coho counts", fill="Expansion", colour="Expansion") +
  scale_x_date(date_breaks="7 day", date_labels = "%b %d") +
  #scale_y_continuous(limits=c(0, max(AUCdataTable[AUCdataTable$ShortSpecies=="CO",]$ExpLiveAdults,na.rm=T))) +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1),
        legend.position = "bottom") +
  facet_wrap(~Section_AreaInspected, scales="free_y")
```

Figure: Live Adult Coho raw counts (blue) and counts expanded for % population and/or OE (pink). 

<br>

## Counts & environmentals

```{r}
ggplot() +
  geom_ribbon(data=nit.water %>% filter(date>=as.Date("2023-08-24")) %>% group_by(date) %>% summarize(min=min(gauge_m), max=max(gauge_m)), 
              aes(x=as.Date(date), ymin=min*200, ymax=max*200), fill="dodger blue", alpha=0.5) +
  geom_line(data=nit.water %>% filter(date>=as.Date("2023-08-24")) %>% group_by(date) %>% summarize(mean = mean(gauge_m)), 
            aes(x=as.Date(date), y=mean*200), colour="dodger blue") +
  geom_bar(data=nit.sil %>% filter(species=="Coho") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
             summarize(n=sum(`adults live / habitat seen (# Est Live)`)), 
           aes(x=as.Date(date), y=n, group=type, fill=`upper/lower (for Nitinat River only)`, colour=`upper/lower (for Nitinat River only)`), 
           stat="identity", position="stack", alpha=0.7) +
  # geom_line(data=nit.sil %>% filter(species=="Coho") %>% group_by(date) %>% 
  #             summarize(n=sum(`adults dead`)), 
  #           aes(x=as.Date(date), y=n), 
  #           stat="identity", position="stack") +
  scale_y_continuous(sec.axis = sec_axis(~./200, name="Staff gauge (m)")) +
  scale_x_date(date_breaks="7 day", date_labels="%b %d") +
  labs(x="", y="Expanded adult Coho", fill="Segment", colour="Segment") +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```

Figure: Coho counts (expanded adults) and water levels (blue line) 

<br>

<br>

## Behaviour & carcasses

```{r}
ggplot() +
  geom_bar(data=nit.sil %>% filter(species=="Coho") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
             summarize(Spawning=sum(`adults # spawning`),
                       Holding = sum(`adults # holding`)) %>% pivot_longer(cols=c(Spawning,Holding), names_to="behaviour", values_to="count"), 
           aes(x=as.Date(date), y=count, fill=behaviour, colour=`upper/lower (for Nitinat River only)`), 
           stat="identity", position="stack", alpha=0.7, size=1) +
  geom_point(data=nit.sil %>% filter(species=="Coho") %>% group_by(date) %>% 
               summarize(n=sum(`adults dead`)), 
             aes(x=as.Date(date), y=n*1), size=2, alpha=0.5) +
  geom_line(data=nit.sil %>% filter(species=="Coho") %>% group_by(date) %>% 
              summarize(n=sum(`adults dead`)), 
            aes(x=as.Date(date), y=n*1), 
            stat="identity", position="stack") +
  #scale_y_continuous(sec.axis = sec_axis(~./1, name="Carcasses")) +
  scale_x_date(date_breaks="7 day", date_labels = "%b %d")+
  scale_fill_manual(breaks=waiver(), values=c("transparent", "gray")) +
  labs(x="", y="Spawning adult Coho", fill="Behaviour", colour="Segment") +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```
<br>

Figure: Expanded live adult Coho (bars) and carcasses (black line). Bar fill indicates behaviour (spawning=gray, holding=white), bar outline indicates river segment (upper=blue, lower=pink).

<br>

<br>

## Snorkel & swim-in counts

```{r}
  # ggplot() +
  #   geom_bar(data=nit.sil %>% filter(species=="Chum") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
  #              summarize(n=sum(`adults live / habitat seen (# Est Live)`)), 
  #            aes(x=as.Date(date), y=n, group=type, fill=`upper/lower (for Nitinat River only)`, colour=`upper/lower (for Nitinat River only)`), 
  #            stat="identity", position="stack", alpha=0.7) + 
  #   geom_bar(data=nrh.cm, 
  #            aes(x=as.Date(`Start Date`), y=`Total Count`*5), fill="black", stat="identity", alpha=0.7) +
  #   scale_y_continuous(sec.axis = sec_axis(~./5, name="Swim ins")) +
  #   scale_x_date(date_breaks="7 day", date_labels = "%b %d")+
  #   labs(x="", y="Expanded adult Chum", fill="Segment", colour="Segment") +
  #   theme_bw() +
  #   theme(axis.text.x = element_text(angle=45, hjust=1)),
  
  ggplot() +
    geom_bar(data=nit.sil %>% filter(species=="Coho") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
               summarize(Spawning=sum(`adults # spawning`),
                         Holding = sum(`adults # holding`)) %>% pivot_longer(cols=c(Spawning,Holding), names_to="behaviour", values_to="count"), 
             aes(x=as.Date(date), y=count, fill=behaviour, colour=`upper/lower (for Nitinat River only)`), 
             stat="identity", position="stack", alpha=0.7, size=1) +
     geom_bar(data=nrh.co %>% filter(ParentActivityType=="Adult Capture", grepl("Swim Ins", InventoryLot)) %>% 
               group_by(`Activity Start Date`) %>% summarize(n=sum(TotalCount)),
              aes(x=as.Date(`Activity Start Date`), y=n), fill="black", stat="identity", alpha=0.7) +
    #scale_y_continuous(sec.axis = sec_axis(~./5, name="Swim ins")) +
    scale_x_date(date_breaks="7 day", date_labels = "%b %d") +
    scale_fill_manual(breaks=waiver(), values=c("transparent", "gray")) +
    labs(x="", y="Adult Coho", fill="Behaviour", colour="Segment") +
    theme_bw() +
    theme(axis.text.x = element_text(angle=45, hjust=1))
```

Figure: Expanded adult Coho counts (large bars) and swim-ins (narrow black bars). Adult bar fill colours indicate behaviour (spawning=gray, holding=white), bar line colour indicates river segment (lower=pink, upper=blue). 

<br>

<br>

## Tributaries (River and Lake)

Live Coho were present in Campus, NoName and Worthless Creeks in 2023.

```{r}
tribs.sil %>% 
  filter(species=="Coho") %>% 
  group_by(trib_status, system) %>% 
  summarize(exp_ad_live = sum(`adults live / habitat seen (# Est Live)`),
            dead_adults = sum(`adults dead`)) %>%
  mutate(across(c(exp_ad_live:dead_adults), ~round(., 0))) %>%
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1), valign="middle", target=1) 
```

<br>

```{r}
ggplot() +
  geom_bar(data=nit.sil %>% 
             filter(species=="Coho") %>% 
             group_by(surveyNum, date, system) %>% 
             summarize(Spawning=sum(`adults # spawning`),
                       Holding = sum(`adults # holding`)) %>% 
             pivot_longer(cols=c(Spawning,Holding), names_to="behaviour", values_to="count"), 
           aes(x=as.Date(date), y=count, fill=behaviour, colour=system), 
           stat="identity", position="stack", alpha=0.7, size=1, width=1) +
  geom_bar(data = tribs.sil %>% 
             filter(species=="Coho", trib_status=="Nitinat trib") %>% 
             group_by(system, date) %>% 
             summarize(Spawning=sum(`adults # spawning`),
                       Holding = sum(`adults # holding`)) %>% 
             pivot_longer(cols=c(Spawning,Holding), names_to="behaviour", values_to="count"),
           aes(x=as.Date(date), y=count*1, colour=system, fill=behaviour), stat="identity",  alpha=0.8, size=1, width=1) +
  scale_y_continuous(sec.axis = sec_axis(~./1, name="Trib count")) +
  scale_fill_manual(breaks=waiver(), values=c("transparent", "gray")) +
  labs(x="", y="mainstem count") +
  theme_bw()
```

Figure: Mainstem Nitinat (pink) and trib (blue/green) counts for Coho adults (raw).  

<br>

<br>

## AUC assessments

<br>

The information below is meant to assist with determining if AUC is an appropriate method, and whether to include/exclude certain surveys. 

<br>

Table: AUC math for systems receiving AUC estimate in `r analysis_year`

```{r}
escEstAUC %>%
  filter(AREA!="20", ShortSpecies=="CO", grepl("Nitinat", SystemName)) 
```

<br>

```{r}
ggplot() +
  geom_line(data=escEstAUC%>%filter(ShortSpecies=="CO", AREA!="20", grepl("Nitinat", SystemName)), 
            aes(x=as.Date(DateRange), y=ExpAdultFishDays)) +
  geom_point(data=escEstAUC%>%filter(ShortSpecies=="CO", AREA!="20", grepl("Nitinat", SystemName)), 
             aes(x=as.Date(DateRange), y=ExpAdultFishDays, fill=method, colour=method), shape=21, size=4) +
  scale_fill_manual(breaks=c("heli", "snorkel"), values=c("orange", "blue")) +
  scale_colour_manual(breaks=c("heli", "snorkel"), values=c("orange", "blue")) +
  labs(x="", y="Fish-days", fill="Survey method", colour="Survey method") +
  theme_bw()
```

Figure: AUC curvey for Nitinat mainstem Sockeye. Note in 2023 this had already excluded the heli survey, but in future would likely also include the flight for reference. 

<br>

<br>


## Area 21-22 preliminary escapement estimate (AUC/PL+D) 

<br>

Table: Raw swim data (raw and expanded live and dead) for Coho.

```{r}
AUCdataTable %>% 
  filter(ShortSpecies=="CO") %>% 
  select(ShortSpecies,Section_AreaInspected, SDate, WaterTemperature, WaterClarity, LiveAdults, DeadAdults,LiveJacks,DeadJacks, ExpLiveAdults,
         ExpDeadAdults, ExpLiveJacks, ExpDeadJacks, OverallReliability, EstPctSeen) %>% 
  mutate(across(c(LiveAdults:ExpDeadJacks), ~round(., 0))) %>% 
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1:4), valign="middle", target=1) 
```

<br>

Table: Escapement estimates for each system.   

```{r}
escEstSpp %>% 
  filter(ShortSpecies=="CO", AREA!="20") %>% 
  select(-c(WatershedCode, contains("Recommend"), EstimateConfidence, OptimumEscapement, n, contains("Raw"), contains("FishDays"))) %>% 
  relocate(c(SystemName, AREA), .before=ShortSpecies) %>% 
  rename(FinalAdultEstimate = AdultNaturalReco,
         FinalJackEstimate = JackNaturalReco) %>% 
  mutate(across(FinalJackEstimate:FinalAdultEstimate, ~case_when(.<0 ~ 0,
                                                                 TRUE ~ .))) %>%
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1:4), valign="middle", target=1) 
```

<br>

### Estimate decision:

For 2023 estimate we went with PL+D as even the highest AUC estimate didn't cover the peak raw live count and timing/coverage wasn't great for AUC (no spawning observed). Expanded PL+D = 1364 adults + 154 jacks (1518 total). ADDED swim-ins due to survey timing relative to swim ins this year (see graph above - swim ins were already in the hatchery by the time the PL+D count happened): 1092 adult swim-ins and 58 jacks. With swim-ins added, final escapement estimate is  1364+1092 = 2456 adults + 212 jacks (2668 total). *This is subject to change; see EscBatchHardCopy report for specific estimate abundance.*

<br>

<br>

## `r analysis_year` compared to historical run timing and abundance

```{r}
ggplot() +
  geom_point(data=nit.rtStWk%>%filter(species=="coho"),
           aes(x=stat_week, y=count, colour=plot_group, fill=plot_group, size=plot_group),
           shape=21, alpha=0.7) +
  scale_fill_manual(breaks=waiver(), values=c("gray60", "dodger blue")) +
  scale_colour_manual(breaks=waiver(), values=c("gray60", "dodger blue")) +
  scale_size_manual(breaks=waiver(), values=c(1.5,3.5)) +
  labs(x="Stat week", y="Live adult Coho", fill="Year:", colour="Year:", size="Year:") +
  theme_bw() +
  theme(legend.position = "bottom",
        legend.box = "horizontal")
```

Figure: Raw swim counts (blue) from this year compared to historical raw swim counts. Stat weeks indicate the month (8=August, 12=December) and week of momth (1=first week, 2=2nd week, etc.), e.g., 81=First week of August, 91=First week of September, etc. 

<br>

```{r}
ggplot()  +
  geom_bar(data=nit.esc %>% filter(`Waterbody Name`=="NITINAT RIVER", `Species Qualified`=="CO"), 
           aes(x=`Analysis Year`, y=`Natural Adult Spawners`), stat="identity", colour="dodger blue", fill="dodger blue", alpha=0.8) +
  geom_bar(data=nit.esc %>% filter(`Waterbody Name`=="NITINAT RIVER", `Species Qualified`=="CO"), 
           aes(x=`Analysis Year`, y=`Unspecified Return`), stat="identity", colour="gray80", fill="gray80", alpha=0.8) +  
  geom_bar(data=escEstSpp %>% 
             filter(ShortSpecies=="CO", AREA!="20", grepl("Nitinat", SystemName)) %>% 
             select(Year, SystemName, AdultNaturalReco) %>% 
             summarize(n=sum(AdultNaturalReco)), 
             aes(x=analysis_year, y=n), stat="identity", colour="red", fill="dodger blue", alpha=0.4) +    scale_x_continuous(breaks=seq(min(nit.esc$`Analysis Year`), analysis_year, by=2)) +
  labs(x="Return Year", y="Coho spawners") +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```

Figure: `r analysis_year` preliminary adult Coho escapement estimate (red outline) relative to historical adult (blue) and unspecified (gray) escapement estimates. Gaps indicate years without estimates. 

<br>

<br>























# **Chum** 

<br>

Six snorkel surveys and one helicopter survey were conducted for Chum in 2023. The heli survey may have been slightly early for Chum. 

<br>

## Raw vs expanded counts

Counts are expanded for both % population surveyed and/or observer efficiency, depending on survey conditions.  

```{r}
ggplot() +
  geom_bar(data=ver23 %>% filter(ShortSpecies=="CM") %>% pivot_longer(LiveAdults:ExpDeadJacks, names_to="est_type", values_to="n") %>% filter(est_type %in% c("LiveAdults", "ExpLiveAdults")), 
           aes(x=as.Date(Date), y=n, colour=est_type, fill=est_type), stat="identity", position="dodge", alpha=0.5) +
  labs(x="", y="Adult Chum counts", fill="Expansion", colour="Expansion") +
  scale_x_date(date_breaks="7 day", date_labels = "%b %d") +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```

Figure: Live Adult Chum raw counts (blue) and counts expanded for % population and/or OE (pink).

<br>

## Counts & environmentals

```{r}
ggplot() +
  geom_ribbon(data=nit.water %>% filter(date>=as.Date("2023-08-24")) %>% group_by(date) %>% summarize(min=min(gauge_m), max=max(gauge_m)), 
              aes(x=as.Date(date), ymin=min*5000, ymax=max*5000), fill="dodger blue", alpha=0.5) +
  geom_line(data=nit.water %>% filter(date>=as.Date("2023-08-24")) %>% group_by(date) %>% summarize(mean = mean(gauge_m)), 
            aes(x=as.Date(date), y=mean*5000), colour="dodger blue") +
  geom_bar(data=nit.sil %>% filter(species=="Chum") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
             summarize(n=sum(`adults live / habitat seen (# Est Live)`)), 
           aes(x=as.Date(date), y=n, group=type, fill=`upper/lower (for Nitinat River only)`, colour=`upper/lower (for Nitinat River only)`), 
           stat="identity", position="stack", alpha=0.7) +
  # geom_line(data=nit.sil %>% filter(species=="Chum") %>% group_by(date) %>% 
  #             summarize(n=sum(`adults dead`)), 
  #           aes(x=as.Date(date), y=n), 
  #           stat="identity", position="stack") +
  scale_y_continuous(sec.axis = sec_axis(~./5000, name="Staff gauge (m)")) +
  scale_x_date(date_breaks="7 day", date_labels="%b %d") +
  labs(x="", y="Expanded adult Chum", fill="Segment", colour="Segment") +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```

Figure: Chinook counts (expanded adults) and water levels (blue line) 

<br>

<br>

## Behaviour & carcasses

```{r}
  # ggplot() +
  #   geom_bar(data=nit.sil %>% filter(species=="Chum") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
  #              summarize(n=sum(`adults live / habitat seen (# Est Live)`)), 
  #            aes(x=as.Date(date), y=n, fill=`upper/lower (for Nitinat River only)`, colour=`upper/lower (for Nitinat River only)`), 
  #            stat="identity", position="stack", alpha=0.7) +
  #   geom_point(data=nit.sil %>% filter(species=="Chum") %>% group_by(date) %>% 
  #                summarize(n=sum(`adults dead`)), 
  #              aes(x=as.Date(date), y=n*10), size=2, alpha=0.5) +
  #   geom_line(data=nit.sil %>% filter(species=="Chum") %>% group_by(date) %>% 
  #               summarize(n=sum(`adults dead`)), 
  #             aes(x=as.Date(date), y=n*10), 
  #             stat="identity", position="stack") +
  #   scale_y_continuous(sec.axis = sec_axis(~./10, name="Carcasses")) +
  #   scale_x_date(date_breaks="7 day", date_labels = "%b %d")+
  #   labs(x="", y="Expanded live adult Chum", fill="Segment", colour="Segment") +
  #   theme_bw() +
  #   theme(axis.text.x = element_text(angle=45, hjust=1)),
  
  ggplot() +
    geom_bar(data=nit.sil %>% filter(species=="Chum") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
               summarize(Spawning=sum(`adults # spawning`),
                         Holding = sum(`adults # holding`)) %>% pivot_longer(cols=c(Spawning,Holding), names_to="behaviour", values_to="count"), 
             aes(x=as.Date(date), y=count, fill=behaviour, colour=`upper/lower (for Nitinat River only)`), 
             stat="identity", position="stack", alpha=0.7, size=1) +
    geom_point(data=nit.sil %>% filter(species=="Chum") %>% group_by(date) %>% 
                 summarize(n=sum(`adults dead`)), 
               aes(x=as.Date(date), y=n*10), size=2, alpha=0.5) +
    geom_line(data=nit.sil %>% filter(species=="Chum") %>% group_by(date) %>% 
                summarize(n=sum(`adults dead`)), 
              aes(x=as.Date(date), y=n*10), 
              stat="identity", position="stack") +
    scale_y_continuous(breaks=seq(0,20000, by=2500), sec.axis = sec_axis(~./10, name="Carcasses")) +
    scale_x_date(date_breaks="7 day", date_labels = "%b %d")+
    scale_fill_manual(breaks=waiver(), values=c("transparent", "gray")) +
    labs(x="", y="Spawning adult Chum", fill="Behaviour", colour="Segment") +
    theme_bw() +
    theme(axis.text.x = element_text(angle=45, hjust=1))
```
<br>

Figure: Expanded live adult Chum (bars) and carcasses (black line). Bar fill indicates behaviour (spawning=gray, holding=white), bar outline indicates river segment (upper=blue, lower=pink)

<br>

<br>

## Snorkel & swim-in counts

```{r}
  # ggplot() +
  #   geom_bar(data=nit.sil %>% filter(species=="Chum") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
  #              summarize(n=sum(`adults live / habitat seen (# Est Live)`)), 
  #            aes(x=as.Date(date), y=n, group=type, fill=`upper/lower (for Nitinat River only)`, colour=`upper/lower (for Nitinat River only)`), 
  #            stat="identity", position="stack", alpha=0.7) + 
  #   geom_bar(data=nrh.cm, 
  #            aes(x=as.Date(`Start Date`), y=`Total Count`*5), fill="black", stat="identity", alpha=0.7) +
  #   scale_y_continuous(sec.axis = sec_axis(~./5, name="Swim ins")) +
  #   scale_x_date(date_breaks="7 day", date_labels = "%b %d")+
  #   labs(x="", y="Expanded adult Chum", fill="Segment", colour="Segment") +
  #   theme_bw() +
  #   theme(axis.text.x = element_text(angle=45, hjust=1)),
  
  ggplot() +
    geom_bar(data=nit.sil %>% filter(species=="Chum") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
               summarize(Spawning=sum(`adults # spawning`),
                         Holding = sum(`adults # holding`)) %>% pivot_longer(cols=c(Spawning,Holding), names_to="behaviour", values_to="count"), 
             aes(x=as.Date(date), y=count, fill=behaviour, colour=`upper/lower (for Nitinat River only)`), 
             stat="identity", position="stack", alpha=0.7, size=1) +
    geom_bar(data=nrh.cm,
             aes(x=as.Date(`Start Date`), y=`Total Count`*5), fill="black", stat="identity", alpha=0.7) +
    scale_y_continuous(sec.axis = sec_axis(~./5, name="Swim ins")) +
    scale_x_date(date_breaks="7 day", date_labels = "%b %d") +
    scale_fill_manual(breaks=waiver(), values=c("transparent", "gray")) +
    labs(x="", y="Adult Chum", fill="Behaviour", colour="Segment") +
    theme_bw() +
    theme(axis.text.x = element_text(angle=45, hjust=1))
```

Figure: Expanded adult Chum counts (large bars) and swim-ins (narrow black bars). Adult bar fill colours indicate behaviour (spawning=gray, holding=white), bar line colour indicates river segment (lower=pink, upper=blue).

<br>

<br>

## Preliminary escapement estimate (AUC) 

<br>

Table: Raw chum counts

```{r}
ver23 %>% 
  filter(ShortSpecies=="CM") %>% 
  select(-c(FabricatedZero)) %>% 
  mutate(across(c(LiveAdults:ExpDeadJacks), ~round(., 0))) %>% 
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1:4), valign="middle", target=1)
```

<br>

```{r}
ggarrange(
ggplot() +
  geom_line(data=AUC23%>%filter(estMethod=="with heli", species=="Chum"), aes(x=as.Date(Date), y=ExpAdultFishDays)) +
  geom_point(data=AUC23%>%filter(estMethod=="with heli", species=="Chum"), 
             aes(x=as.Date(Date), y=ExpAdultFishDays, fill=surveyMethod, colour=surveyMethod), shape=21, size=4) +
  scale_fill_manual(breaks=c("heli", "snorkel"), values=c("orange", "blue")) +
  scale_colour_manual(breaks=c("heli", "snorkel"), values=c("orange", "blue")) +
  labs(x="", y="Fish-days", fill="", colour="") +
  theme_bw(),

ggplot() +
  geom_line(data=AUC23%>%filter(estMethod=="without heli", species=="Chum"), aes(x=as.Date(Date), y=ExpAdultFishDays)) +
  geom_point(data=AUC23%>%filter(estMethod=="without heli", species=="Chum"), 
             aes(x=as.Date(Date), y=ExpAdultFishDays, fill=surveyMethod, colour=surveyMethod), shape=21, size=4) +
  scale_fill_manual(breaks=c("heli", "snorkel"), values=c("orange", "blue")) +
  scale_colour_manual(breaks=c("heli", "snorkel"), values=c("orange", "blue")) +
  labs(x="", y="Fish-days", fill="", colour="") +
  theme_bw(),
nrow=2,
common.legend = T, legend = "bottom"
)
```

Figure: AUC curves with heli (top) and without heli (bottom) survey. 

<br>

Table: AUC math (SIL+AUC database math extracted: SIL+AUC_database_output_2024-01-03 - AUC.xlsx)

```{r}
AUC23 %>% 
  filter(species=="Chum") %>% 
  relocate(surveyMethod, .before=Date) %>% 
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1:4), valign="middle", target=1) 
```

<br>

Table: Escapement estimates with/without helicopter survey for each survey life value.

```{r}
# auc23 %>% 
#   filter(species=="chum") %>%
#   group_by(method) %>% 
#   summarize(fish_days_SL8 = round(sum(`expanded adult`)/8,0),
#             fish_days_SL10 = round(sum(`expanded adult`)/10,0),
#             fish_days_SL15 = round(sum(`expanded adult`)/15,0)) %>% 
#   pivot_longer(cols=c(fish_days_SL8:fish_days_SL15), names_to = "Rank", values_to="Estimate") %>% 
#   mutate(Rank = case_when(grepl("8", Rank) ~ "Low Value",
#                            grepl("10", Rank) ~ "Middle Value",
#                            grepl("15", Rank) ~ "High Value"),
#          SL = case_when(grepl("Low", Rank) ~ 8,
#                         grepl("Middle", Rank) ~ 10,
#                         grepl("High", Rank) ~ 15),
#          Est_without_swimins = 
#            Estimate - 
#            nrh.cm %>% 
#               summarize(n=sum(TotalCount)) %>%
#               pull(n)
#            ) %>%
#   relocate(SL, .after = Rank) %>%
#   kbl(align="c") %>%
#   kable_paper("hover", full_width=T, position = "center") %>%
#   collapse_rows(columns=c(1:4), valign="middle", target=1) 

AUC23 %>% 
  filter(species=="Chum") %>%
  select(-c(species)) %>%
  group_by(estMethod) %>% 
  summarize(fishDays = sum(ExpAdultFishDays),
            est_SLL = round(fishDays/10,0),
            est_SLM = round(fishDays/15,0),
            est_SLH = round(fishDays/20,0)) %>% 
  pivot_longer(cols=c(est_SLL:est_SLH), names_to = "Rank", values_to="Estimate") %>% 
  mutate(Rank = case_when(grepl("SLL", Rank) ~ "Low Value",
                           grepl("SLM", Rank) ~ "Middle Value",
                           grepl("SLH", Rank) ~ "High Value"),
         SL = case_when(grepl("Low", Rank) ~ 10,
                        grepl("Middle", Rank) ~ 15,
                        grepl("High", Rank) ~ 20)) %>%
  relocate(SL, .after = Rank) %>%
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1:4), valign="middle", target=1) 
```

<br>

### Estimate decision:

For 2023 used AUC with SL=11.5 days (mid value) to give exapnded estimate of 27,530. Swim-ins need to be SUBTRACTED from this to account for fish that were likely double-counted: the peak live count occurred on the full system heli survey and therefore likely counted chum that later swam into the hatchery (see swim-in graph above). Subtracting the swim-ins for accounting (6186) leaves 21,344 chum.

<br>

<br>

## Tributaries

Live chum were present in Campus and Hobiton Creek in 2023, and dead chum were noted in NoName Creek. Opportunistic surveys of Caycuse and Doobah found no chum. 

```{r}
tribs.sil %>% 
  filter(species=="Chum") %>% 
  group_by(system) %>% 
  summarize(exp_ad_live = sum(`adults live / habitat seen (# Est Live)`),
            dead_adults = sum(`adults dead`)) %>%
  mutate(across(c(exp_ad_live:dead_adults), ~round(., 0))) %>%
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1), valign="middle", target=1) 
```

<br>

<br>

## `r analysis_year` compared to historical run timing

```{r}
ggplot() +
  geom_point(data=nit.rtStWk%>%filter(species=="chum"),
           aes(x=stat_week, y=count, colour=plot_group, fill=plot_group, size=plot_group),
           shape=21, alpha=0.7) +
  scale_fill_manual(breaks=waiver(), values=c("gray60", "dodger blue")) +
  scale_colour_manual(breaks=waiver(), values=c("gray60", "dodger blue")) +
  scale_size_manual(breaks=waiver(), values=c(1.5,3.5)) +
  labs(x="Stat week", y="Live adult Coho", fill="Year:", colour="Year:", size="Year:") +
  theme_bw() +
  theme(legend.position = "bottom",
        legend.box = "horizontal")
```

<br>

```{r}
ggplot()  +
  geom_bar(data=nit.esc %>% filter(`Waterbody Name`=="NITINAT RIVER", `Species Qualified`=="CM"), 
           aes(x=`Analysis Year`, y=`Natural Adult Spawners`), stat="identity", colour="dodger blue", fill="dodger blue", alpha=0.8) +
  geom_bar(data=nit.esc %>% filter(`Waterbody Name`=="NITINAT RIVER", `Species Qualified`=="CM"), 
           aes(x=`Analysis Year`, y=`Unspecified Return`), stat="identity", colour="gray80", fill="gray80", alpha=0.8) +  
  geom_bar(aes(x=analysis_year, y=30000), stat="identity", colour="orange", fill="orange", alpha=0.8) +   
  scale_x_continuous(breaks=seq(min(nit.esc$`Analysis Year`), analysis_year, by=2)) +
  labs(x="Return Year", y="Chum spawners") +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```

Figure: 2023 preliminary adult Chum escapement estimate (orange) relative to historical adult (blue) and unspecified (gray) escapement estimates. There was no Chum estimate available in 1990. 

<br>

<br>




























# **Chinook**

Six snorkel surveys and one helicopter survey were conducted for Chinook in 2023. 

<br>

## Raw vs expanded counts

Counts are expanded for both % population surveyed and/or observer efficiency, depending on survey conditions.  

```{r}
ggplot() +
  geom_bar(data=ver23 %>% 
             filter(ShortSpecies=="CN") %>% 
             pivot_longer(LiveAdults:ExpDeadJacks, names_to="est_type", values_to="n") %>% 
             filter(est_type %in% c("LiveAdults", "ExpLiveAdults")), 
           aes(x=as.Date(Date), y=n, colour=est_type, fill=est_type), stat="identity", position="dodge", alpha=0.5) +
  labs(x="", y="Adult Chinook counts", fill="Expansion", colour="Expansion") +
  scale_x_date(date_breaks="7 day", date_labels = "%b %d") +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```

Figure: Live Adult Coho raw counts (blue) and counts expanded for % population and/or OE (pink). 

<br>

## Counts & environmentals

```{r }
ggplot() +
  geom_ribbon(data=nit.water %>% filter(date>=as.Date("2023-08-24")) %>% group_by(date) %>% summarize(min=min(gauge_m), max=max(gauge_m)), 
              aes(x=as.Date(date), ymin=min*5000, ymax=max*5000), fill="dodger blue", alpha=0.5) +
  geom_line(data=nit.water %>% filter(date>=as.Date("2023-08-24")) %>% group_by(date) %>% summarize(mean = mean(gauge_m)), 
            aes(x=as.Date(date), y=mean*5000), colour="dodger blue") +
  geom_bar(data=nit.sil %>% filter(species=="Chinook") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
             summarize(n=sum(`adults live / habitat seen (# Est Live)`)), 
           aes(x=as.Date(date), y=n, group=type, fill=`upper/lower (for Nitinat River only)`, colour=`upper/lower (for Nitinat River only)`), 
           stat="identity", position="stack", alpha=0.7) +
  # geom_line(data=nit.sil %>% filter(species=="Chinook") %>% group_by(date) %>% 
  #             summarize(n=sum(`adults dead`)), 
  #           aes(x=as.Date(date), y=n), 
  #           stat="identity", position="stack") +
  labs(x="", y="Expanded adult Chinook") +
  scale_y_continuous(sec.axis = sec_axis(~./5000, name="Staff gauge (m)")) +
  scale_x_date(date_breaks="7 day", date_labels="%b %d") +
  labs(x="", Y="Live chinook", fill="Segment", colour="Segment") +
  theme_bw() +
  theme(axis.text.x = element_text(angle=45, hjust=1))
```

Figure: Chinook counts (expanded adults) and water levels (blue line) 

<br>

<br>

## Behaviour & carcasses

```{r}
  # ggplot() +
  #   geom_bar(data=nit.sil %>% filter(species=="Chinook") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
  #              summarize(n=sum(`adults live / habitat seen (# Est Live)`)), 
  #            aes(x=as.Date(date), y=n, fill=`upper/lower (for Nitinat River only)`, colour=`upper/lower (for Nitinat River only)`), 
  #            stat="identity", position="stack", alpha=0.7) +
  #   geom_point(data=nit.sil %>% filter(species=="Chinook") %>% group_by(date) %>% 
  #                summarize(n=sum(`adults dead`)), 
  #              aes(x=as.Date(date), y=n*10), size=2, alpha=0.5) +
  #   geom_line(data=nit.sil %>% filter(species=="Chinook") %>% group_by(date) %>% 
  #               summarize(n=sum(`adults dead`)), 
  #             aes(x=as.Date(date), y=n*10), 
  #             stat="identity", position="stack") +
  #   scale_y_continuous(sec.axis = sec_axis(~./10, name="Carcasses")) +
  #   scale_x_date(date_breaks="7 day", date_labels = "%b %d")+
  #   labs(x="", y="Expanded live adult Chinook", fill="Segment", colour="Segment") +
  #   theme_bw() +
  #   theme(axis.text.x = element_text(angle=45, hjust=1)),
  
  ggplot() +
    geom_bar(data=nit.sil %>% filter(species=="Chinook") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
               summarize(Spawning=sum(`adults # spawning`),
                         Holding = sum(`adults # holding`)) %>% pivot_longer(cols=c(Spawning,Holding), names_to="behaviour", values_to="count"), 
             aes(x=as.Date(date), y=count, fill=behaviour, colour=`upper/lower (for Nitinat River only)`), 
             stat="identity", position="stack", alpha=0.7, size=1) +
    geom_point(data=nit.sil %>% filter(species=="Chinook") %>% group_by(date) %>% 
                 summarize(n=sum(`adults dead`)), 
               aes(x=as.Date(date), y=n*10), size=2, alpha=0.5) +
    geom_line(data=nit.sil %>% filter(species=="Chinook") %>% group_by(date) %>% 
                summarize(n=sum(`adults dead`)), 
              aes(x=as.Date(date), y=n*10)) +
    scale_y_continuous(breaks=seq(0,20000,by=2500), sec.axis = sec_axis(~./10, name="Carcasses")) +
    scale_x_date(date_breaks="7 day", date_labels = "%b %d")+
    scale_fill_manual(breaks=waiver(), values=c("transparent", "gray")) +
    labs(x="", y="Spawning adult Chinook", fill="Behaviour", colour="Segment") +
    theme_bw() +
    theme(axis.text.x = element_text(angle=45, hjust=1))
```
<br>

Figure: Expanded live adult Chinook (bars) and carcasses (black line). Bar fill indicates behaviour (spawning=gray, holding=white), bar outline indicates river segment (upper=blue, lower=pink).

<br>

<br>

## Snorkel & swim-in counts

```{r}
  # ggplot() +
  #   geom_bar(data=nit.sil %>% filter(species=="Chinook") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
  #              summarize(n=sum(`adults live / habitat seen (# Est Live)`)), 
  #            aes(x=as.Date(date), y=n, group=type, fill=`upper/lower (for Nitinat River only)`, colour=`upper/lower (for Nitinat River only)`), 
  #            stat="identity", position="stack", alpha=0.7) + 
  #   geom_bar(data=nrh.cn %>% filter(`Parent Activity Type`=="Adult Capture", grepl("Swim Ins", `Inventory Lot`)) %>% 
  #              group_by(`Activity Start Date`) %>% summarize(n=sum(`Total Count`)),
  #            aes(x=as.Date(`Activity Start Date`), y=n*1), fill="black", stat="identity", alpha=0.7) +
  #   scale_y_continuous(sec.axis = sec_axis(~./1, name="Swim ins")) +
  #   scale_x_date(date_breaks="7 day", date_labels = "%b %d")+
  #   labs(x="", y="Expanded adult Chinook", fill="Segment", colour="Segment") +
  #   theme_bw() +
  #   theme(axis.text.x = element_text(angle=45, hjust=1)),
  
  ggplot() +
    geom_bar(data=nit.sil %>% filter(species=="Chinook") %>% group_by(date, type, `upper/lower (for Nitinat River only)`) %>% 
               summarize(Spawning=sum(`adults # spawning`),
                         Holding = sum(`adults # holding`)) %>% pivot_longer(cols=c(Spawning,Holding), names_to="behaviour", values_to="count"), 
             aes(x=as.Date(date), y=count, fill=behaviour, colour=`upper/lower (for Nitinat River only)`), 
             stat="identity", position="stack", alpha=0.7, size=1) +
    geom_bar(data=nrh.cn %>% filter(ParentActivityType=="Adult Capture", grepl("Swim Ins", InventoryLot)) %>% 
               group_by(`Activity Start Date`) %>% summarize(n=sum(TotalCount)),
             aes(x=as.Date(`Activity Start Date`), y=n*1), fill="black", stat="identity", alpha=0.7) +
    scale_y_continuous(sec.axis = sec_axis(~./1, name="Swim ins")) +
    scale_x_date(date_breaks="7 day", date_labels = "%b %d") +
    scale_fill_manual(breaks=waiver(), values=c("transparent", "gray")) +
    labs(x="", y="Adult Chinook", fill="Behaviour", colour="Segment") +
    theme_bw() +
    theme(axis.text.x = element_text(angle=45, hjust=1))
```

Figure: Expanded adult Chinook counts (large bars) and swim-ins (narrow black bars). Adult bar fill colours indicate behaviour (spawning=gray, holding=white), bar line colour indicates river segment (lower=pink, upper=blue).

<br>

<br>

## Infilling missing segment (2023)

<br> 

On Oct 5 the section 5-4 (Eagle Pool) was not swum due to bears - a bank wank and approximation from a distance occurred. 

```{r}
ggarrange(
  ggplot() +
    geom_bar(data=nit.sil %>%
               filter(species%notin%c("Steelhead", "Cutthroat Trout")) %>%
               mutate(group = case_when(segment=="5-4" ~ "5-4",
                                        TRUE ~ "other")) %>%
               group_by(date, group, species) %>%
               summarize(total_adults = sum(`adults live`)),
             aes(x=as.Date(date), y=total_adults, fill=group, colour=group), stat="identity") +
    geom_bar(data=nit.sil %>% 
               filter(species%notin%c("Steelhead", "Cutthroat Trout")) %>% 
               mutate(group = case_when(segment=="5-4" ~ "5-4",
                                        TRUE ~ "other")) %>%
               group_by(date, species) %>% 
               summarize(total_adults = sum(`adults live`)) %>%
               filter(date==as.Date("2023-10-05")),
             aes(x=as.Date(date), y=total_adults), stat="identity", fill="transparent", colour="black", width=5) +
    scale_x_date(breaks="5 day", date_labels="%b %d") +
    theme_bw() +
    theme(axis.text.x = element_text(angle=45, hjust=1)) +
    facet_wrap(~species),
  
  
  
  ggplot() +
    geom_bar(data=nit.sil %>% 
               filter(species%notin%c("Steelhead", "Cutthroat Trout")) %>% 
               mutate(group = case_when(segment=="5-4" ~ "5-4",
                                        TRUE ~ "other")) %>%
               group_by(date, group, species) %>% 
               summarize(total_adults = sum(`adults live`)) %>% 
               group_by(date, species) %>% 
               mutate(perc = total_adults/sum(total_adults)),
             aes(x=as.Date(date), y=perc, fill=group, colour=group), stat="identity") +
    geom_bar(data=nit.sil %>% 
               filter(species%notin%c("Steelhead", "Cutthroat Trout")) %>% 
               mutate(group = case_when(segment=="5-4" ~ "5-4",
                                        TRUE ~ "other")) %>%
               group_by(date, group, species) %>% 
               summarize(total_adults = sum(`adults live`)) %>% 
               group_by(date, species) %>% 
               mutate(perc = total_adults/sum(total_adults)) %>% 
               filter(date==as.Date("2023-10-05")),
             aes(x=as.Date(date), y=perc), stat="identity", fill="transparent", colour="black", width=5) +
    scale_x_date(breaks="5 day", date_labels="%b %d") +
    scale_y_continuous(breaks=seq(0,1,by=0.1)) +
    theme_bw() +
    theme(axis.text.x = element_text(angle=45, hjust=1)) +
    facet_wrap(~species),
  
  nrow=1, common.legend = T)
```

Figure: Number and proportion of counts in segment 5-4 (pink) compared to the other segments (blue). 

<br>

Recommend applying 95% pop to chinook and chum and 90% to coho. 

<br>

## Preliminary escapement estimate (AUC/PL+D) 

<br>

Table: Raw chinook counts

```{r}
ver23 %>% 
  filter(ShortSpecies=="CN") %>% 
  select(-c(FabricatedZero)) %>% 
  mutate(across(c(LiveAdults:ExpDeadJacks), ~round(., 0))) %>% 
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1:4), valign="middle", target=1) 
```

<br>

```{r}
ggarrange(
ggplot() +
  geom_line(data=AUC23%>%filter(estMethod=="with heli", species=="Chinook"), aes(x=as.Date(Date), y=ExpAdultFishDays)) +
  geom_point(data=AUC23%>%filter(estMethod=="with heli", species=="Chinook"), 
             aes(x=as.Date(Date), y=ExpAdultFishDays, fill=surveyMethod, colour=surveyMethod), shape=21, size=4) +
  scale_fill_manual(breaks=c("heli", "snorkel"), values=c("orange", "blue")) +
  scale_colour_manual(breaks=c("heli", "snorkel"), values=c("orange", "blue")) +
  labs(x="", y="Fish-days", fill="", colour="") +
  theme_bw(),

ggplot() +
  geom_line(data=AUC23%>%filter(estMethod=="without heli", species=="Chinook"), aes(x=as.Date(Date), y=ExpAdultFishDays)) +
  geom_point(data=AUC23%>%filter(estMethod=="without heli", species=="Chinook"), 
             aes(x=as.Date(Date), y=ExpAdultFishDays, fill=surveyMethod, colour=surveyMethod), shape=21, size=4) +
  scale_fill_manual(breaks=c("heli", "snorkel"), values=c("orange", "blue")) +
  scale_colour_manual(breaks=c("heli", "snorkel"), values=c("orange", "blue")) +
  labs(x="", y="Fish-days", fill="", colour="") +
  theme_bw(),

nrow=2,
common.legend = T, legend = "bottom"
)
```

Figure: Chinook AUC curves with heli (top) and without heli (bottom) survey. 

<br>

Table: AUC math (SIL+AUC database math extracted: SIL+AUC_database_output_2024-01-03 - AUC.xlsx)

```{r}
AUC23 %>% 
  filter(species=="Chinook") %>% 
  relocate(surveyMethod, .before=Date) %>% 
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1:4), valign="middle", target=1) 
```

<br>

Table: Escapement estimates with/without helicopter survey for each survey life value.
```{r}
AUC23 %>% 
  filter(species=="Chinook") %>%
  select(-c(species)) %>%
  group_by(estMethod) %>% 
  summarize(fishDays = sum(ExpAdultFishDays),
            est_SL15 = round(fishDays/15,0),
            est_SL20 = round(fishDays/20,0),
            est_SL25 = round(fishDays/25,0)) %>% 
  pivot_longer(cols=c(est_SL15:est_SL25), names_to = "Rank", values_to="Estimate") %>% 
  mutate(Rank = case_when(grepl("15", Rank) ~ "Low Value",
                           grepl("20", Rank) ~ "Middle Value",
                           grepl("25", Rank) ~ "High Value"),
         SL = case_when(grepl("Low", Rank) ~ 15,
                        grepl("Middle", Rank) ~ 20,
                        grepl("High", Rank) ~ 25),
         Est_without_swimins = Estimate - (nrh.cn %>% 
              filter(grepl("Swim In", InventoryLot) & ParentActivityType=="Adult Capture" & SourceLocationType=="Brailer" & 
                       MaturityClass%in%c("Male","Female")) %>% 
              summarize(n=sum(TotalCount)) %>%
              pull(n))) %>%
  relocate(SL, .after = Rank) %>%
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") %>%
  collapse_rows(columns=c(1:4), valign="middle", target=1) 
```

<br>

### Estimate decision:   

For 2023 estimate we went with expand AUC SL=15 for three reasons: First, there were a lot more swim-ins than usual this year, which was attributed to the COVID releases leaving the hatchery directly rather than being reared in the lake pen. Fish homing to the hatchery may have had more directed migration and therefore not did not stay in the system long. Second, the higher estimate from the shorter SL resulted in an estimate that was high enough to cover the raw peak live count of ~15k,  but once removing the 6846 adult and 113 jack swim-ins, still resulted in a reasonable estimate that agreed with what the hatchery observed. Third, there may have been a slight delay in entry as the water was low for the early season and rains were a bit later than usual (though not as late as 2022). The Expanded AUC adult estimate for 2023 spawners = 21,093 adults and 116 jacks. After swim-in removal, final estimate is 14,247 adults and 3 jacks.  *This is subject to change; see EscBatchHardCopy report for specific estimate abundance.*  

<br>

<br>

## Tributaries

Chinook were not seen in any Nitinat River or Lake tributaries in 2023.

```{r}
tribs.sil %>% 
  filter(species=="Chinook") %>% 
  group_by(system) %>% 
  summarize(exp_ad_live = sum(`adults live / habitat seen (# Est Live)`)) %>%
  kbl(align="c") %>%
  kable_paper("hover", full_width=T, position = "center") 
```

<br>

<br>

## `r analysis_year` compared to historical run timing and abundances

```{r}
ggplot() +
  geom_point(data=nit.rtStWk%>%filter(species=="chinook"),
           aes(x=stat_week, y=count, colour=plot_group, fill=plot_group, size=plot_group),
           shape=21, alpha=0.7) +
  scale_fill_manual(breaks=waiver(), values=c("gray60", "dodger blue")) +
  scale_colour_manual(breaks=waiver(), values=c("gray60", "dodger blue")) +
  scale_size_manual(breaks=waiver(), values=c(1.5,3.5)) +
  labs(x="Stat week", y="Live adult Chinook", fill="Year:", colour="Year:", size="Year:") +
  theme_bw() +
  theme(legend.position = "bottom",
        legend.box = "horizontal")
```

Figure: Return timing of Chinook in 2023 relative to recent returns. 

<br>

```{r}
ggplot()  +
  geom_hline(data=nit.esc.goal %>% filter(RP=="SMSY"), aes(yintercept=Value)) +
  geom_bar(data=nit.esc %>% filter(`Waterbody Name`=="NITINAT RIVER", `Species Qualified`=="CK"), 
           aes(x=`Analysis Year`, y=`Natural Adult Spawners`), stat="identity", colour="dodger blue", fill="dodger blue", alpha=0.8) +
  geom_bar(data=nit.esc %>% filter(`Waterbody Name`=="NITINAT RIVER", `Species Qualified`=="CK"), 
           aes(x=`Analysis Year`, y=`Unspecified Return`), stat="identity", colour="gray80", fill="gray80", alpha=0.8) +  
  geom_bar(aes(x=analysis_year, y=14252), stat="identity", colour="orange", fill="orange", alpha=0.8) +   
  scale_x_continuous(breaks=seq(min(nit.esc$`Analysis Year`), analysis_year, by=2)) +
  labs(x="Return year", y="Chinook spawners") +
  theme_bw()+
  theme(axis.text.x = element_text(angle=45, hjust=1))
```

Figure: 2023 preliminary adult Chinook escapement estimate (orange) relative to historical adult (blue) and unspecified (gray) escapement estimates.

<br>

<br>

<br>














# **Pink** 

No consistent WCVI pink runs. For 2023 pink count was n=4. 

